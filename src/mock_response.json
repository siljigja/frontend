{
  "id": "rpt_49ea3856-0fd8-477d-a569-677a86c984c7",
  "scanId": "scan_addb399d-749f-4b5b-879c-e31ab27a7aa9",
  "projectId": "prj_2606bb3b-a285-4104-9a5f-03948512cfec",
  "userId": "usr_a4b1fc44-1bd0-4cd5-8ca3-fbcbdc0a622e",
  "summary": {
    "totalIssues": 2,
    "highSeverity": 1,
    "recommendation": "High 등급 취약점을 우선적으로 수정하세요."
  },
  "generatedAt": "2025-11-24T04:19:00.088Z",
  "issues": [
    {
      "id": "ISSUE-001-oauth-csrf-state-missing",
      "name": "OAuth authorization code 교환 시 CSRF/state 검증 누락 (State/PKCE 미검증)",
      "description": "문제 코드(발췌):\nconst exchangeGithubCode = async (code) => {\n  // ...\n  const tokenResponse = await axios.post('https://github.com/login/oauth/access_token', { client_id: config.oauth.githubClientId, client_secret: config.oauth.githubClientSecret, code }, ...);\n}\n\n위 코드에서는 전달된 authorization code가 호출자(세션)와 연동되어 있는지 확인하는 로직이 없습니다. OAuth authorization code를 세션에 바인딩(예: state 파라미터 또는 PKCE 검증)하지 않으면 CSRF/로그인 바인딩 우회로 인해 공격자가 자신의 OAuth 승인을 유도해 피해자 계정에 악의적 계정을 연결시키거나 인증 흐름을 탈취할 수 있습니다. 서버 측에서 code 교환 전 state(또는 PKCE verifier)를 검증해야 합니다.",
      "fix_code": "// 전제: 초기 인증 요청 시 세션 또는 저장소에 state를 저장해야 함(예: req.session.oauthState = generatedState)\n// 함수 시그니처를 변경해 state와 기대값(expectedState)을 전달받아 검증\nconst exchangeGithubCode = async ({ code, state, expectedState }) => {\n  if (!state || state !== expectedState) {\n    throw new Error('OAuth state 검증에 실패했습니다.');\n  }\n\n  if (!config.oauth.githubClientId || !config.oauth.githubClientSecret) {\n    throw new Error('GitHub OAuth 환경 변수가 설정되지 않았습니다.');\n  }\n\n  const tokenResponse = await axios.post(\n    'https://github.com/login/oauth/access_token',\n    {\n      client_id: config.oauth.githubClientId,\n      client_secret: config.oauth.githubClientSecret,\n      code\n    },\n    {\n      headers: { Accept: 'application/json' },\n      timeout: 10000\n    }\n  );\n\n  // 이후 로직은 기존과 동일\n};\n\n/* 사용 예시:\n   // express 핸들러에서\n   // const expectedState = req.session.oauthState;\n   // await exchangeGithubCode({ code: req.query.code, state: req.query.state, expectedState });\n*/",
      "severity": "High",
      "file_path": null,
      "start_line": 36,
      "end_line": 56,
      "confidence": 0.95,
      "exploit_example": "읽기 전용 시연: 악성 사용자는 자신의 GitHub 인증을 통해 얻은 'code'와 자신의 state(또는 빈값)를 피해자 인증 콜백에 전달해 서버가 state를 검증하지 않으면 계정 연결이 의도치 않게 발생할 수 있습니다(비파괴적 판정).",
      "display_meta": {
        "severity_color": "#FF6B00",
        "highlight_lines": [
          36,
          56
        ],
        "fix_color": "#0A66FF",
        "pill_color": "#FF6B00"
      }
    },
    {
      "id": "ISSUE-002-logging-sensitive-token",
      "name": "액세스 토큰 등 민감정보가 로깅될 수 있음 (로그 노출로 인한 토큰 유출 위험)",
      "description": "문제 코드(발췌):\nconst accessToken = tokenResponse.data.access_token;\nif (!accessToken) {\n  logger.error('GitHub OAuth 토큰 발급 실패', { response: tokenResponse.data });\n  throw new Error('GitHub 액세스 토큰 발급에 실패했습니다.');\n}\n\nerror 로그에 tokenResponse.data 전체를 포함하면 access_token 또는 다른 민감한 필드(client_secret 등)가 로그에 남아 로그 접근 권한이 있는 사람에게 유출될 수 있습니다. 로그에는 민감정보를 포함하지 않거나, 민감 필드를 마스킹/제거해야 합니다.",
      "fix_code": "// 민감 필드를 제거/마스킹하는 유틸 추가\nfunction redactTokenResponse(resp) {\n  if (!resp || typeof resp !== 'object') return resp;\n  const clone = { ...resp };\n  if (clone.access_token) clone.access_token = '[REDACTED]';\n  if (clone.refresh_token) clone.refresh_token = '[REDACTED]';\n  if (clone.client_secret) clone.client_secret = '[REDACTED]';\n  return clone;\n}\n\n// 사용 예시(기존 코드 대체):\nconst accessToken = tokenResponse.data.access_token;\nif (!accessToken) {\n  logger.error('GitHub OAuth 토큰 발급 실패', { response: redactTokenResponse(tokenResponse.data) });\n  throw new Error('GitHub 액세스 토큰 발급에 실패했습니다.');\n}\n\n/* 전제: logger에 전송되기 전 로그 수집기(ELK 등)로도 민감 데이터가 전파되지 않도록 로그 레벨/스크럽 정책을 검토하세요. */",
      "severity": "Medium",
      "file_path": null,
      "start_line": 54,
      "end_line": 57,
      "confidence": 0.95,
      "exploit_example": "읽기 전용 시연: 실패 시 tokenResponse.data 전체가 로깅되면 로그 검색에서 access_token 값을 확인할 수 있으며, 로그 접근 권한이 있는 내부자 또는 유출된 로그로 인해 계정 세션 탈취 가능(비파괴적 확인).",
      "display_meta": {
        "severity_color": "#FFC107",
        "highlight_lines": [
          54,
          57
        ],
        "fix_color": "#0A66FF",
        "pill_color": "#FFC107"
      }
    }
  ]
}

